<!--d-->
{% extends "auctions/layout.html" %}

{% block body %}
<div class="container mt-4">
    <h2>{{ listing.title }}</h2>
    <img src="{{ listing.image_url }}"
         alt="{{ listing.image_url }}"
         class="img-fluid mb-3"
         style="max-height: 400px;
         object-fit:cover;">

    <p><strong>Description:</strong> {{ listing.description }}</p>
    <p><strong>Starting Price:</strong >${{ listing.price }}</p>
    <p><strong>Category:</strong> {{ listing.category }}</p>
    <p><strong>Created by:</strong> {{ listing.owner }}</p>

 {% if user.is_authenticated %}
 <form action="{% url 'toggle_watchlist' listing.id %}" method="post">
        {% csrf_token %}
        {% if user in listing.watchlist.all %}
        <button type="submit" class="btn btn-warning">Remove From Watchlist</button>
        {% else %}
        <button type="submit" class="btn btn-success">Add To Watchlist</button>
        {% endif %}
    </form>
    {% else %}
    <p><a href="{% url 'login' %}">Login</a>to add to your watchlist.</p>
{% endif %}

<form action="{% url 'add_comment' listing.id %}" method="post">
        {%  csrf_token %}
    <textarea name="comment" class="form-control mb-2" placeholder="Comment.." required></textarea>
    <button type="submit" class="btn btn-primary">Add To Comment</button>
</form>
<ul class="mt-3">
    {% for comment in listing.comments.all %}
        <li>
            <strong>{{ comment.user.username }}</strong>:
            {{ comment.content }}
        </li>
    {% empty %}
        <li>No comments yet.</li>
    {% endfor %}
</ul>

{% if user == listing.owner and listing.is_active %}
<form action="{% url 'close_auction' listing.id %}" method="post" class="mt-3">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">
        Close Auction
    </button>
</form>
{% endif %}

<form action="{% url 'place_bid' listing.id %}" method="post">
    {% csrf_token %}
    <input type="number" step="0.01" name="bid_amount" placeholder="Enter Your Bid" requred>
    <button type="submit" class="btn btn-success">Submit</button>
</form>

{% if listing.is_active %}
<form action="{% url 'place_bid' listing.id %}" method="post">
    {% csrf_token %}
</form>
{% else %}
<p class="text-danger mt-3"><strong>This auction is closed.</strong></p>
{% endif %}
{% if not listing.is_active and listing.winner %}
<p class="alert alert-success">
    üèÜWinner:<strong>{{ listing.winner.username }}üèÜ</strong>
</p>
{% endif %}

{% if listing.bids.all %}
    <h5>Current Bids:</h5>
    <ul>
        {% for bid in listing.bids.all %}
        <li>${{ bid.amount }} by {{ bid.user.username }}</li>
        {% endfor %}
    </ul>
    {% endif %}
{% endblock %}
